---
title: "Collab-assignment-4"
author: "Rohan Baghel"
date: '2022-05-20'
output: bookdown::html_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  eval = TRUE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  out.width = "80%",
  fig.width = 8, 
  fig.height = 6,
  fig.retina = 3)
set.seed(6)
```

```{r}
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
```

```{r read_data}
La_liga_data <- read.csv("data/laliga_player_stats_english.csv")
```

\section*{Defender}

The motive of this section is to find out the **best defender** in Laliga (Spanish football league), season 2019-2020 according to player stats. We will be analyzing different variables to get the best defender out of the 20 teams. 

```{r}
defender <- La_liga_data %>%
  filter(Position == "Defender") %>%
  select(Team,
         Name,
         Games.played,
         Yellow.Cards,
         Goals.conceded.while.player.on.pitch,
         Interceptions,
         Recoveries,
         Clearances,
         Successful.tackles,
         Unssuccessful.tackles,
         Fouls.committed,
         Successful.duels,
         Duels.lost,
         Successful.aerial.challenges,
         Unsuccessful.aerial.challenges)
```

We will try to find the best defender by going through different levels, the major one being, trying to find the player who has the most recoveries and clearances. 

* Recovery  - A recovery is recorded at the point where the player of the team beginning the possession touches the ball. 

* Clearance - When a player kicks the ball away from the goal they are defending. 

We will only analyze players who have played more than 50% of the games, considering consistency is key factor for a 38 matches long league.

```{r CvsR, fig.align = 'center', fig.cap = "Clearances vs Recoveries"}
defender1 <- defender %>%
  filter(Games.played >= 19)
ggplot(defender1,
       aes(x = Clearances,
           y = Recoveries,
           colour = Team, 
           label = Name)) +
  theme_minimal() +
  geom_text(size = 5) +
  theme_gray(base_size = 15) +
  geom_point() +
  labs(y = "Number of clearances",
       x = "Number of Recoveries",
       title = "Clearances Vs.Recoveries")
  
  
```

From \@ref(fig:CvsR) we can say that **Pique** from **Barcelona** and **Laguardia** from **D. Alaves** have managed to do exceptionally well. Out of the two players, we will try to choose the best defender by bringing in more variables into the picture. 

```{r better}
defender2 <- defender1 %>%
  filter(Name == "Piqué" | Name == "Laguardia") %>%
  mutate(tackles = (Successful.tackles/(Successful.tackles + Unssuccessful.tackles)*100)) %>%
  mutate(duels = (Successful.duels/(Successful.duels + Duels.lost)*100)) %>%
  mutate(aerials = (Successful.aerial.challenges/(Unsuccessful.aerial.challenges +
                                                    Successful.aerial.challenges)*100))

name <- defender2$Name
teams <- defender2$Team
Tackles_success <- defender2$tackles
Duels_success <- defender2$duels
Aerials_success <- defender2$aerials

better <- data.frame(name, teams, goals_conceded, Tackles_success, Duels_success, Aerials_success)

knitr::kable(better, caption = "Comparison of Pique and Laguardia (better)")
  
```
In the table above \@ref(tab:better) we have calculated the percentage of succeessful tackles, duels and Aerial duels won by the each of the defender who came on top in \@ref(fig:CvsR) i.e Pique and Laguardia. Laguardia top the charts between him and Pique in Successful tackles made and Duels won but the difference is bleak. Pique had 20% more Aerial duel success than Laguardia. 

Seems like both of them are are still going to head to head. Now we have to judge them by number of mistakes made by them during the season.

```{r worse}
defender3 <- defender1 %>%
  filter(Name == "Piqué" | Name == "Laguardia")

name <- defender2$Name
teams <- defender2$Team
goals_conceded <- defender2$Goals.conceded.while.player.on.pitch
yellow <- defender3$Yellow.Cards
fouls <- defender3$Fouls.committed

worse <- data.frame(name, goals_conceded, teams, yellow, fouls)

knitr::kable(worse, caption = "Comparison of Pique and Laguardia (worse)")
```

From the table \@ref(tab:worse) we can see Pique has made lesser mistakes in a match the while being on the field as compared to Laguardia. His team conceded lesser goals, he made lesser fouls which resulted him getting penalized less often. We can conclude from our analysis that Pique from Barcelona had the most impact as a defender. On top of that he was also able to contribute in the attack as he scored 4 goals for FC Barcelona.

```{r}
scored <- La_liga_data %>%
  filter(Name == "Piqué") %>%
  select(Name, Team,  Goals.scored)

scored
```



# Position: Forward

The aim of this section is to analyse which player is the best in the *Forward position* in the LaLiga Tournament based on data from 2019-2020.  

```{r Filter-Data}
Forward <- La_liga_data %>%
  filter (Position == "Forward")

Forward <- Forward %>%
  select(Team, Name, Games.played, Yellow.Cards, Goals.scored, Penalties.scored, Successful.tackles, Recoveries, Successful.duels, Assists, Interceptions, Recoveries, Successful.aerial.challenges) %>%
  rename("Games_played" = Games.played,
         "Yellow_cards" = Yellow.Cards,
         "Goals_scored" = Goals.scored,
         "Penalties_scored" = Penalties.scored,
         "Successful_tackles" = Successful.tackles,
         "Successful_duels" = Successful.duels,
         "Successful_aerial_challenges" = Successful.aerial.challenges)
```

Goals Scored, Penalties Scored and Assists account for the most successful outcome given by a player in the Forward position.

```{r Goals-Analysis}
Forward <- Forward %>%
  mutate(goals_per_game = ((Goals_scored + Penalties_scored + Assists)/Games_played)) %>%
  arrange(desc(goals_per_game)) %>%
  mutate(Goal_rank = 1:94)

Forward_Goal <- Forward %>%
  slice_head(n=5) %>%
  select(Team, Name, goals_per_game, Goal_rank) %>%
  kable(caption = "Top 5 forward position players for goals per game") %>%
  kable_styling(position = "center")

Forward_Goal
```

The table \@ref(tab:Goals-Analysis) displays the Name and Team of the top 5 players in the forward position with the highest goals, penalties and assists per game. Messi from Team FC Barcelona holds the first rank in this analysis with an average of 1.55 goals per match, followed by lago Aspas and Suárez.

```{r Success-Scores}
Forward <- Forward %>%
  mutate(success_score = (Successful_tackles + Successful_duels + Successful_aerial_challenges)/Games_played) %>%
  arrange(desc(success_score))  %>%
  mutate(Score_rank = 1:94)

Forward_Score <- Forward  %>%
  slice_head(n=5) %>%
  select(Team, Name, success_score, Score_rank) %>%
  kable(caption = "Top 5 forward position players for Success Score") %>%
  kable_styling(position = "center")

Forward_Score
```
As seen from the table \@ref(tab:Success-Scores), Calleri from team D. Alavés tops the table  with a total success score of 10.02 followed by Enric Gallego and Carrillo The Success score in this table is calculated by adding the successful duels, tackles and aerial challenges by each player divided by the number of games they have played.

```{r goals-v-success, fig.cap = "Goals vs Success score", fig.align='center'}

library(plotly)
p <- ggplot(Forward) + geom_point(aes(x=success_score, y = goals_per_game, hoverinfo = Name)) + labs(x = "Success Score", y = "Goals", title = "Goals vs Success Score")
ggplotly(p)
```
The figure \@ref(fig:goals-v-success) is a scatter plot of all the players' goals and success score per game. The players that occur on the top right corner are so far the top players in our analysis. By hovering the cursor over points we can see that Messi appears to be one of the top players.


```{r Yellow-cards, fig.cap = "Top 20 yellow card players", fig.align='center'}
Forward_yellow <- Forward %>% select(Team, Name, Yellow_cards) %>%
  arrange(desc(Yellow_cards)) %>% slice_head(n=20)

ggplot(Forward_yellow) + geom_col(aes(y=Yellow_cards, x=fct_reorder(Name, Yellow_cards)), fill = "#F6BE00") + 
  theme(axis.text.x = element_text(angle = 45)) +
  labs(title = "Highest yellow card players")
```

The figure \@ref(fig:Yellow-cards) displays the players with the highest number of yellow cards. 

```{r Top}
Forward_top <- Forward %>% anti_join(Forward_yellow) %>%
  mutate(rank = (Goal_rank + Score_rank)/2) %>%
  arrange(rank) %>%
  select(Team, Name) %>% 
  slice_head(n=5)

Forward_top <- Forward_top %>% slice_head(n=5) %>%
  kable(caption = "Top 5 forward position players") %>%
  kable_styling(position = "center")

Forward_top
```

The table \@ref(tab:Top) displays the top 5 forward position players in the LaLiga Tournament according to the 2019-2022 data on the basis of their goals, assists, successful duels and tackles per game and after removing the players with high number of yellow cards. **[Messi from FC Barcelona](images/messi.jpeg)** is at the top of the list followed by M. Gómez, Jorge Molina, Williams and Enric Gallego.\


# Section-3

# Section-4

